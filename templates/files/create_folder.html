{% extends "base/base.html" %}
{% block content %}

<!-- ================= CREATE FOLDER CARD ================= -->
<div class="max-w-xl mx-auto bg-gray-800 p-8 rounded-2xl shadow-lg">

    <h2 class="text-xl font-semibold text-white mb-6">
        Create Folder
    </h2>

    <form method="post" class="space-y-6">
        {% csrf_token %}

        <!-- Folder Name -->
        <div class="space-y-1">
            <label class="text-sm text-gray-300">
                Folder name
            </label>
            {{ form.name }}
        </div>

        <!-- Category -->
        <div class="space-y-1">
            <div class="flex items-center justify-between">
                <label class="text-sm text-gray-300">
                    Category
                </label>

                <button type="button"
                        id="openCategoryModal"
                        class="text-xs text-blue-400 hover:underline">
                    + New category
                </button>
            </div>

            {{ form.category }}
        </div>

        <!-- Actions -->
        <div class="flex justify-end gap-3 pt-6">
            <a href="{% url 'file_hub' %}"
               class="px-4 py-2 rounded-lg bg-gray-700
                      text-sm text-gray-200 hover:bg-gray-600 transition">
                Cancel
            </a>

            <button type="submit"
                    class="px-4 py-2 rounded-lg bg-blue-600
                           text-sm font-medium text-white
                           hover:bg-blue-500 transition">
                Create
            </button>
        </div>
    </form>

</div>

<!-- ================= CATEGORY MODAL ================= -->
<div id="categoryModal"
     class="fixed inset-0 bg-black/60
            hidden flex items-center justify-center
            z-50">

    <div class="bg-gray-800 p-6 rounded-xl w-full max-w-sm shadow-xl">

        <h3 class="text-lg font-semibold text-white mb-4">
            New Category
        </h3>

        <input type="text"
               id="newCategoryName"
               placeholder="Category name"
               class="w-full px-3 py-2 rounded-lg
                      bg-gray-900 border border-gray-700
                      text-sm text-gray-200
                      placeholder-gray-500
                      focus:outline-none focus:ring-2 focus:ring-blue-500">

        <div class="flex justify-end gap-3 mt-6">
            <button id="closeCategoryModal"
                    class="px-4 py-2 rounded-lg bg-gray-700
                           text-sm text-gray-200 hover:bg-gray-600 transition">
                Cancel
            </button>

            <button id="createCategoryBtn"
                    class="px-4 py-2 rounded-lg bg-blue-600
                           text-sm font-medium text-white hover:bg-blue-500 transition">
                Create
            </button>
        </div>
    </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("categoryModal");
    const openBtn = document.getElementById("openCategoryModal");
    const closeBtn = document.getElementById("closeCategoryModal");
    const createBtn = document.getElementById("createCategoryBtn");
    const input = document.getElementById("newCategoryName");
    const select = document.querySelector("select[name='category']");

    openBtn.onclick = () => modal.classList.remove("hidden");
    closeBtn.onclick = () => modal.classList.add("hidden");

    createBtn.onclick = () => {
        const name = input.value.trim();
        if (!name) return;

        fetch("{% url 'create_category_ajax' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: "name=" + encodeURIComponent(name)
        })
        .then(res => res.json())
        .then(data => {
            const option = new Option(data.name, data.id, true, true);
            select.add(option);
            modal.classList.add("hidden");
            input.value = "";
        });
    };
});
</script>

{% endblock %}
