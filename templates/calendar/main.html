{% extends 'base/base.html' %}
{% block content %}

<!-- ================= HEADER ================= -->
<div class="flex justify-between items-center mb-8">
    <h2 class="text-2xl font-semibold text-white">
        Academic Calendar
    </h2>

    <a href="{% url 'add_calendar_event' %}"
       class="bg-blue-600 text-white px-4 py-2.5 rounded-lg text-sm font-medium
              hover:bg-blue-500 transition">
        + Add Event / Holiday
    </a>
</div>

<!-- ================= FILTERS ================= -->
<div class="flex flex-wrap gap-4 mb-6 text-sm text-gray-200">
    <label class="flex items-center gap-2">
        <input type="checkbox" class="calendar-filter" checked data-type="class">
        Classes
    </label>
    <label class="flex items-center gap-2">
        <input type="checkbox" class="calendar-filter" checked data-type="exam">
        Exams
    </label>
    <label class="flex items-center gap-2">
        <input type="checkbox" class="calendar-filter" checked data-type="holiday">
        Holidays
    </label>
    <label class="flex items-center gap-2">
        <input type="checkbox" class="calendar-filter" checked data-type="event">
        Events
    </label>
</div>

<!-- ================= CALENDAR CARD ================= -->
<div class="bg-gray-800 p-4 rounded-xl shadow-xl">
    <div id="calendar"></div>
</div>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<style>
.fc {
    --fc-page-bg-color: #1f2937;
    --fc-neutral-bg-color: #374151;
    --fc-border-color: #4b5563;
    --fc-today-bg-color: rgba(59,130,246,0.2);
    color: #e5e7eb;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',   // ✅ MONTH FIRST
        height: 'auto',
        eventDisplay: 'block',
        expandRows: false,

        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek'
        },

        events: {{ events|safe }}
    });

    calendar.render();

    // ✅ FILTER LOGIC (SAFE & WORKING)
    document.querySelectorAll('.calendar-filter').forEach(cb => {
        cb.addEventListener('change', () => {
            calendar.getEvents().forEach(ev => {
                const type = ev.extendedProps.type;
                const checked = document.querySelector(
                    `.calendar-filter[data-type="${type}"]`
                )?.checked;

                ev.setProp('display', checked ? 'auto' : 'none');
            });
        });
    });
});
</script>

{% endblock %}
